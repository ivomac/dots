#!/usr/bin/env bash

set -euo pipefail
shopt -s failglob

if [[ "$1" == \+* ]]; then
  command="${1#\+}"
  shift
fi

nvim --server "$NVIM" --remote-send "<cmd>lua require('floatterm').close_all()<CR>" &&
  sleep 0.01 &&
  nvim --server "$NVIM" --remote "${@}"

if [[ -n "$command" ]]; then
  nvim --server "$NVIM" --remote-send "<cmd>${command}<CR>"
fi
